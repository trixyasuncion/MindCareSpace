<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MindCareSpace â€” Daily Reflection Prompts</title>

<style>
  :root{
    --bg1: #f3e9f6;
    --bg2: #e7f6fa;
    --accent: #6a2c91; /* purple */
    --muted: #6b6b6b;
    --card:#ffffff;
    --shadow: 0 6px 18px rgba(0,0,0,0.08);
    --radius:14px;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: 'Segoe UI', Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    background: linear-gradient(180deg, #f7eefc 0%, #eef8fb 100%);
    color:#222;
  }

  header{
    background: linear-gradient(90deg, rgba(106,44,145,0.95), rgba(169,120,206,0.9));
    color:white;
    padding:22px 28px;
    box-shadow:var(--shadow);
    position:sticky;
    top:0;
    z-index:10;
    border-bottom:4px solid rgba(0,0,0,0.02);
  }
  header .title{
    font-weight:700;
    font-size:28px;
    display:flex;
    gap:12px;
    align-items:center;
  }
  header .subtitle{
    font-size:13px;
    opacity:0.95;
    margin-top:6px;
  }

  main{
    max-width:1100px;
    margin:28px auto;
    padding:0 20px 80px;
  }

  .hero{
    text-align:center;
    margin-bottom:28px;
  }
  .hero h1{
    margin:12px 0 6px;
    font-size:34px;
    color:var(--accent);
  }
  .hero p{
    margin:0;
    color:var(--muted);
    font-size:15px;
  }

  .container{
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:22px;
    align-items:start;
  }

  /* Left column: prompts & editor */
  .panel{
    background:var(--card);
    border-radius:var(--radius);
    padding:20px;
    box-shadow:var(--shadow);
  }

  .prompts{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:16px;
  }
  .prompt-chip{
    background:linear-gradient(180deg,#fff,#f6f5ff);
    border-radius:12px;
    padding:8px 12px;
    cursor:pointer;
    border:1px solid rgba(106,44,145,0.06);
    font-weight:600;
    color:var(--accent);
    box-shadow: 0 3px 8px rgba(106,44,145,0.06);
  }
  .prompt-chip.active{
    background:linear-gradient(90deg,#ffd7f0,#f5e7ff);
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(106,44,145,0.12);
  }

  .editor{
    display:block;
  }
  .editor label{
    display:block;
    margin-bottom:6px;
    color:var(--muted);
    font-weight:600;
  }
  textarea#answer{
    width:100%;
    min-height:160px;
    resize:vertical;
    padding:14px;
    border-radius:10px;
    border:1px solid rgba(0,0,0,0.06);
    font-size:15px;
    line-height:1.5;
    box-shadow:none;
    background:linear-gradient(180deg,#fff,#faf8ff);
  }

  .controls{
    display:flex;
    gap:10px;
    margin-top:12px;
    align-items:center;
  }
  .btn{
    background:var(--accent);
    color:white;
    padding:10px 14px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:700;
    box-shadow:0 6px 16px rgba(106,44,145,0.12);
  }
  .btn.secondary{
    background:white;
    color:var(--accent);
    border:1px solid rgba(106,44,145,0.12);
    box-shadow:none;
    font-weight:600;
  }
  .small{
    padding:8px 10px;
    font-size:14px;
  }

  .meta{
    margin-left:auto;
    color:var(--muted);
    font-size:13px;
  }

  /* Saved entries list */
  .entries{
    margin-top:20px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .entry{
    border-radius:10px;
    border:1px solid rgba(0,0,0,0.04);
    padding:12px;
    background:linear-gradient(180deg,#fff,#fbfbff);
  }
  .entry .top{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .entry .date{
    font-weight:700;
    color:var(--accent);
  }
  .entry .text{
    margin-top:8px;
    white-space:pre-wrap;
    color:#333;
  }
  .entry .small-actions{
    margin-left:auto;
    display:flex;
    gap:8px;
  }
  .linkish{
    background:none;
    border:none;
    color:var(--accent);
    font-weight:700;
    cursor:pointer;
  }

  /* right column: tips + export */
  aside .panel-title{
    font-weight:800;
    color:var(--accent);
    margin-bottom:8px;
  }
  .side-list{
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .side-card{
    padding:12px;
    border-radius:12px;
    background:linear-gradient(180deg,#fff,#f9f7ff);
    border:1px solid rgba(0,0,0,0.04);
  }
  .option{
    display:flex;
    gap:8px;
    align-items:center;
    cursor:pointer;
    padding:8px;
    border-radius:8px;
  }
  .option:hover{ background: rgba(0,0,0,0.02); }

  /* small screens */
  @media (max-width:980px){
    .container{ grid-template-columns: 1fr; }
    aside{ order:2;}
  }

  footer{
    text-align:center;
    margin-top:28px;
    color:var(--muted);
    font-size:13px;
  }

  /* collapsed/expand animation for entries */
  .collapsible{
    max-height:0;
    overflow:hidden;
    transition: max-height 0.35s ease;
  }
  .collapsible.open{
    max-height:1000px;
  }

  /* print adjustments */
  @media print{
    header, .btn, aside{ display:none !important; }
    body{ background:white !important; }
    .panel{ box-shadow:none !important; border:none !important; }
  }
</style>
</head>
<body>

<header>
  <div class="title">
    <span style="font-size:22px;filter:drop-shadow(0 3px 6px rgba(0,0,0,.25));">ðŸ’œ</span>
    <div>
      MindCareSpace â€” Daily Reflection
      <div class="subtitle">Short guided prompts to structure reflection & support wellbeing</div>
    </div>
  </div>
</header>

<main>
  <div class="hero">
    <h1>Daily Reflection Prompts</h1>
    <p>Pick a prompt, answer it, and save your reflection. Your entries stay on this device.</p>
  </div>

  <div class="container">
    <!-- left column -->
    <section>
      <div class="panel">
        <div style="display:flex;align-items:center;gap:16px;">
          <div style="font-weight:800;color:var(--accent);font-size:16px">Choose a prompt</div>
          <div style="color:var(--muted);font-size:13px">or start a free reflection</div>
          <div class="meta">Local only â€¢ private</div>
        </div>

        <div class="prompts" id="promptsList" aria-hidden="false" style="margin-top:14px;">
          <!-- chips injected by JS -->
        </div>

        <div class="editor">
          <label id="promptLabel">Selected prompt</label>
          <textarea id="answer" placeholder="Write your reflection here..."></textarea>

          <div class="controls">
            <button id="saveBtn" class="btn">Save Reflection</button>
            <button id="clearBtn" class="btn secondary small">Clear</button>
            <button id="exportBtn" class="btn secondary small">Export CSV</button>
            <div class="meta" id="autosaveText">No saved draft</div>
          </div>
        </div>

        <div class="entries" id="entriesWrap" aria-live="polite">
          <!-- saved entries inserted here -->
        </div>
      </div>
    </section>

    <!-- right column -->
    <aside>
      <div class="panel">
        <div class="panel-title">Quick tips</div>
        <div class="side-list">
          <div class="side-card">
            <strong>How to reflect</strong>
            <p style="margin:6px 0 0;color:var(--muted);font-size:14px;">
              Be honest but kind to yourself. Short, regular practice is more helpful than long, rare sessions.
            </p>
          </div>

          <div class="side-card">
            <strong>Export & Print</strong>
            <p style="margin:6px 0 0;color:var(--muted);font-size:14px;">
              Use "Export CSV" to download your reflections. Use Print to get a copy of a single reflection.
            </p>
          </div>

          <div class="side-card" style="display:flex;gap:8px;align-items:center;justify-content:space-between;">
            <div>
              <div style="font-weight:800;color:var(--accent)">Mood quick-check</div>
              <div style="color:var(--muted);font-size:13px;margin-top:6px;">Add a mood tag to a reflection.</div>
            </div>
            <div>
              <select id="moodSelect" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,.06);">
                <option value="">No mood</option>
                <option value="Calm">Calm</option>
                <option value="Happy">Happy</option>
                <option value="Anxious">Anxious</option>
                <option value="Sad">Sad</option>
                <option value="Grateful">Grateful</option>
              </select>
            </div>
          </div>

        </div>
      </div>
    </aside>
  </div>

  <footer>
    Tip: Short daily writing helps build clarity and steadiness over time.
  </footer>
</main>

<script>
/* ---------- Prompt list (edit/add prompts here) ---------- */
const PROMPTS = [
  "What went well today? Name 1â€“3 things.",
  "What was challenging today and what did you learn?",
  "What are you grateful for right now?",
  "How did you take care of yourself today?",
  "Who made a positive difference today? Acknowledge them.",
  "One small kindness I can do tomorrow is...",
  "What emotion showed up the most today? Describe it.",
  "A moment today that felt good was..."
];

/* ---------- Storage keys ---------- */
const STORAGE_KEY = "mindcare:reflections_v1";
const DRAFT_KEY = "mindcare:reflections_draft";

/* ---------- page elements ---------- */
const promptsList = document.getElementById("promptsList");
const promptLabel = document.getElementById("promptLabel");
const answerEl = document.getElementById("answer");
const saveBtn = document.getElementById("saveBtn");
const clearBtn = document.getElementById("clearBtn");
const exportBtn = document.getElementById("exportBtn");
const entriesWrap = document.getElementById("entriesWrap");
const moodSelect = document.getElementById("moodSelect");
const autosaveText = document.getElementById("autosaveText");

/* ---------- state ---------- */
let selectedPromptIndex = 0;
let reflections = loadReflections(); // array of objects

/* ---------- render prompt chips ---------- */
function renderPrompts(){
  promptsList.innerHTML = "";
  PROMPTS.forEach((p, i) => {
    const chip = document.createElement("button");
    chip.className = "prompt-chip" + (i===selectedPromptIndex ? " active": "");
    chip.textContent = p;
    chip.title = p;
    chip.onclick = () => {
      selectedPromptIndex = i;
      updateActiveChip();
      setPromptToEditor();
    };
    promptsList.appendChild(chip);
  });
}
function updateActiveChip(){
  document.querySelectorAll(".prompt-chip").forEach((c, idx)=> {
    c.classList.toggle("active", idx === selectedPromptIndex);
  });
}

/* ---------- set prompt into editor ---------- */
function setPromptToEditor(){
  promptLabel.textContent = PROMPTS[selectedPromptIndex];
  // put prompt as placeholder if empty
  if(!answerEl.value.trim()){
    answerEl.placeholder = PROMPTS[selectedPromptIndex] + " (type your thoughts...)";
  }
}

/* ---------- save / load ---------- */
function saveReflectionsToStorage(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(reflections));
}
function loadReflections(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){
    console.error(e);
    return [];
  }
}

/* ---------- render entries ---------- */
function renderEntries(){
  entriesWrap.innerHTML = "";
  if(reflections.length === 0){
    entriesWrap.innerHTML = `<div style="color:var(--muted);margin-top:12px">No reflections yet â€” write one above and press Save.</div>`;
    return;
  }

  // sort newest first
  const arr = [...reflections].sort((a,b)=> b.time - a.time);

  arr.forEach((r, idx)=>{
    const item = document.createElement("div");
    item.className = "entry";

    const top = document.createElement("div");
    top.className = "top";

    const date = new Date(r.time);
    const dateStr = date.toLocaleString();

    const dateEl = document.createElement("div");
    dateEl.className = "date";
    dateEl.textContent = dateStr;

    const promptEl = document.createElement("div");
    promptEl.style.marginLeft = "10px";
    promptEl.style.color = "#444";
    promptEl.style.fontWeight = 700;
    promptEl.textContent = r.prompt || "Reflection";

    const mood = document.createElement("div");
    mood.style.marginLeft = "8px";
    mood.style.padding = "4px 8px";
    mood.style.borderRadius = "8px";
    mood.style.background = r.mood ? "#f0f7ff":"transparent";
    mood.style.color = "#1b4f9c";
    mood.style.fontWeight = 700;
    mood.textContent = r.mood || "";

    const actions = document.createElement("div");
    actions.className = "small-actions";

    const viewBtn = document.createElement("button");
    viewBtn.className = "linkish";
    viewBtn.textContent = "Open";
    viewBtn.onclick = ()=> toggleCollapse(content);

    const printBtn = document.createElement("button");
    printBtn.className = "linkish";
    printBtn.textContent = "Print";
    printBtn.onclick = ()=> printEntry(r);

    const delBtn = document.createElement("button");
    delBtn.className = "linkish";
    delBtn.textContent = "Delete";
    delBtn.onclick = ()=> {
      if(!confirm("Delete this reflection?")) return;
      reflections = reflections.filter(x=> x.id !== r.id);
      saveReflectionsToStorage();
      renderEntries();
    };

    actions.appendChild(viewBtn);
    actions.appendChild(printBtn);
    actions.appendChild(delBtn);

    top.appendChild(dateEl);
    top.appendChild(promptEl);
    if(r.mood) top.appendChild(mood);
    top.appendChild(actions);

    const content = document.createElement("div");
    content.className = "collapsible open"; // show by default
    const text = document.createElement("div");
    text.className = "text";
    text.textContent = r.text || "";
    content.appendChild(text);

    item.appendChild(top);
    item.appendChild(content);
    entriesWrap.appendChild(item);
  });
}

/* ---------- toggle collapse ---------- */
function toggleCollapse(el){
  el.classList.toggle("open");
}

/* ---------- print single entry ---------- */
function printEntry(r){
  const w = window.open("","_blank","width=700,height=800");
  w.document.write(`<html><head><title>Reflection</title>
    <style>body{font-family:Arial,Helvetica,sans-serif;padding:24px} h1{color:#612a84} pre{white-space:pre-wrap}</style>
    </head><body>`);
  w.document.write(`<h1>${new Date(r.time).toLocaleString()}</h1>`);
  w.document.write(`<h3 style="color:#6a2c91">${r.prompt || "Reflection"}</h3>`);
  w.document.write(`<pre>${escapeHtml(r.text || "")}</pre>`);
  if(r.mood) w.document.write(`<p><strong>Mood:</strong> ${escapeHtml(r.mood)}</p>`);
  w.document.write(`</body></html>`);
  w.document.close();
  w.print();
}

/* ---------- export CSV ---------- */
function exportCSV(){
  if(reflections.length === 0){ alert("No entries to export."); return; }
  const rows = [
    ["id","date","prompt","mood","text"]
  ];
  reflections.forEach(r=>{
    rows.push([r.id, new Date(r.time).toISOString(), r.prompt || "", r.mood || "", r.text.replace(/\r?\n/g,"\\n")]);
  });
  const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "mindcare-reflections.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* ---------- helpers ---------- */
function escapeHtml(s){
  return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));
}

function uuid(){
  return 'id-' + Math.random().toString(36).slice(2,10);
}

/* ---------- autosave draft ---------- */
function loadDraft(){
  try{
    const d = localStorage.getItem(DRAFT_KEY);
    if(!d) return;
    const obj = JSON.parse(d);
    if(obj.promptIndex !== undefined) selectedPromptIndex = obj.promptIndex;
    if(obj.text) answerEl.value = obj.text;
    if(obj.mood) moodSelect.value = obj.mood;
    autosaveText.textContent = "Draft restored";
  }catch(e){ console.warn("draft load failed",e); }
}
function saveDraft(){
  const obj = {
    promptIndex: selectedPromptIndex,
    text: answerEl.value,
    mood: moodSelect.value,
    at: Date.now()
  };
  localStorage.setItem(DRAFT_KEY, JSON.stringify(obj));
  autosaveText.textContent = "Draft saved";
}

/* ---------- initialize ---------- */
function init(){
  renderPrompts();
  setPromptToEditor();
  renderEntries();
  loadDraft();

  // autosave draft every 4s while typing
  let typingTimer = null;
  answerEl.addEventListener("input", ()=> {
    autosaveText.textContent = "Typing...";
    clearTimeout(typingTimer);
    typingTimer = setTimeout(()=> {
      saveDraft();
    }, 1200);
  });

  moodSelect.addEventListener("change", ()=> saveDraft());
}

/* ---------- events ---------- */
saveBtn.onclick = () => {
  const text = answerEl.value.trim();
  if(!text){
    if(!confirm("Save an empty reflection? Press Cancel to continue writing.")) return;
  }
  const entry = {
    id: uuid(),
    time: Date.now(),
    prompt: PROMPTS[selectedPromptIndex],
    mood: moodSelect.value || "",
    text
  };
  reflections.push(entry);
  saveReflectionsToStorage();
  // clear draft
  localStorage.removeItem(DRAFT_KEY);
  answerEl.value = "";
  moodSelect.value = "";
  autosaveText.textContent = "Saved!";
  renderEntries();
};

clearBtn.onclick = ()=> {
  if(!confirm("Clear current draft?")) return;
  answerEl.value = "";
  moodSelect.value = "";
  localStorage.removeItem(DRAFT_KEY);
  autosaveText.textContent = "Draft cleared";
};

exportBtn.onclick = ()=> exportCSV();

/* keyboard shortcut: Ctrl+Enter to save */
answerEl.addEventListener("keydown", (e)=>{
  if((e.ctrlKey || e.metaKey) && e.key === "Enter"){
    saveBtn.click();
  }
});

/* init page */
init();

</script>
</body>
</html>
